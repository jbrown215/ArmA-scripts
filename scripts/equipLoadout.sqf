// Make variables for each loadout

_rifleman = [["rhs_weap_m4_grip","","rhsusf_acc_anpeq15_wmx","rhsusf_acc_ACOG_RMR",["rhs_mag_30Rnd_556x45_M855A1_Stanag",0],[],"rhsusf_acc_grip1"],["rhs_weap_M136","","","",[],[],""],[],["rhs_uniform_cu_ocp_1stcav",[["ACE_EarPlugs",1],["ACE_IR_Strobe_Item",1],["ACE_microDAGR",1],["KNB_Notebook",1],["ACE_RangeCard",1],["ACE_MapTools",1],["ACE_tourniquet",4],["ACE_splint",4],["ACE_morphine",2],["ACE_Flashlight_MX991",1],["ACE_fieldDressing",5],["ACE_packingBandage",2],["ACRE_PRC343_ID_1",1]]],["rhsusf_spcs_ocp_rifleman",[["ACE_elasticBandage",10],["ACE_packingBandage",10],["ACE_quikclot",5],["ACE_morphine",5],["rhs_mag_30Rnd_556x45_M855A1_Stanag",7,30],["rhs_mag_an_m8hc",2,1],["ACE_M84",2,1],["rhs_mag_m67",2,1]]],["rhsusf_assault_eagleaiii_ocp",[["ACE_bodyBag",1],["ACE_EntrenchingTool",1],["ACE_wirecutter",1],["rhs_mag_30Rnd_556x45_M855A1_Stanag_Tracer_Red",5,30]]],"rhsusf_ach_helmet_ocp","",["Rangefinder","","","",[],[],""],["ItemMap","","ItemRadioAcreFlagged","ItemCompass","ItemWatch",""]];

_riflemanCLS = [["rhs_weap_m4_grip","","rhsusf_acc_anpeq15_wmx","rhsusf_acc_ACOG_RMR",["rhs_mag_30Rnd_556x45_M855A1_Stanag",0],[],"rhsusf_acc_grip1"],[],[],["rhs_uniform_cu_ocp_1stcav",[["ACE_EarPlugs",1],["ACE_IR_Strobe_Item",1],["ACE_microDAGR",1],["KNB_Notebook",1],["ACE_RangeCard",1],["ACE_MapTools",1],["ACE_tourniquet",4],["ACE_splint",4],["ACE_morphine",2],["ACE_Flashlight_MX991",1],["ACE_fieldDressing",5],["ACE_packingBandage",2],["ACRE_PRC343_ID_1",1]]],["rhsusf_spcs_ocp_rifleman",[["ACE_elasticBandage",10],["ACE_packingBandage",10],["ACE_quikclot",5],["ACE_morphine",5],["rhs_mag_30Rnd_556x45_M855A1_Stanag",7,30],["rhs_mag_an_m8hc",2,1],["ACE_M84",2,1],["rhs_mag_m67",2,1]]],["rhsusf_assault_eagleaiii_ocp",[["ACE_bodyBag",1],["ACE_EntrenchingTool",1],["ACE_wirecutter",1],["ACE_morphine",10],["ACE_salineIV_500",5],["ACE_quikclot",5],["ACE_packingBandage",10],["ACE_elasticBandage",10],["ACE_epinephrine",5],["ACE_adenosine",5],["rhs_mag_30Rnd_556x45_M855A1_Stanag_Tracer_Red",5,30]]],"rhsusf_ach_helmet_ocp","",["Rangefinder","","","",[],[],""],["ItemMap","","ItemRadioAcreFlagged","ItemCompass","ItemWatch",""]];

_grenadier = [["rhs_weap_m4_m320","","rhsusf_acc_anpeq15_wmx","rhsusf_acc_ACOG_RMR",[],[],""],[],[],["rhs_uniform_cu_ocp_1stcav",[["ACE_EarPlugs",1],["ACE_IR_Strobe_Item",1],["ACE_microDAGR",1],["KNB_Notebook",1],["ACE_RangeCard",1],["ACE_MapTools",1],["ACE_tourniquet",4],["ACE_splint",4],["ACE_morphine",2],["ACE_Flashlight_MX991",1],["ACE_fieldDressing",5],["ACE_packingBandage",2],["ACRE_PRC343",1]]],["rhsusf_spcs_ocp_grenadier",[["rhs_mag_30Rnd_556x45_M855A1_Stanag",7,30],["rhs_mag_M433_HEDP",6,1],["rhs_mag_m67",2,1],["rhs_mag_an_m8hc",2,1]]],["rhsusf_assault_eagleaiii_ocp",[["ACE_packingBandage",5],["ACE_elasticBandage",5],["ACE_fieldDressing",5],["ACE_quikclot",5],["ACE_EntrenchingTool",1],["ACE_morphine",5],["rhs_mag_M433_HEDP",5,1],["ACE_40mm_Flare_red",2,1],["ACE_40mm_Flare_green",2,1],["rhs_mag_m713_Red",2,1],["rhs_mag_m714_White",2,1],["rhs_mag_30Rnd_556x45_M855A1_Stanag_Tracer_Red",5,30]]],"rhsusf_ach_helmet_ocp","",["Rangefinder","","","",[],[],""],["ItemMap","","","ItemCompass","ItemWatch",""]];

_team_squad_leader = [["rhs_weap_m4","","rhsusf_acc_anpeq15_wmx","rhsusf_acc_ACOG_RMR",["rhs_mag_30Rnd_556x45_M855A1_Stanag",30],[],"rhsusf_acc_grip1"],[],["rhsusf_weap_m9","","","",["rhsusf_mag_15Rnd_9x19_JHP",15],[],""],["rhs_uniform_cu_ocp_1stcav",[["ACE_EarPlugs",1],["ACE_IR_Strobe_Item",1],["ACE_microDAGR",1],["KNB_Notebook",1],["ACE_RangeCard",1],["ACE_MapTools",1],["ACE_tourniquet",4],["ACE_splint",4],["ACE_morphine",2],["ACE_Flashlight_MX991",1],["ACE_fieldDressing",5],["ACE_packingBandage",2],["ACRE_PRC343",1]]],["rhsusf_spcs_ocp_teamleader",[["ACRE_PRC152",1],["ACE_quikclot",5],["rhs_mag_an_m8hc",4,1],["rhs_mag_m67",2,1],["rhs_mag_30Rnd_556x45_M855A1_Stanag",7,30],["rhsusf_mag_15Rnd_9x19_FMJ",1,15]]],["rhsusf_assault_eagleaiii_ocp",[["ACE_M26_Clacker",1],["ACE_EntrenchingTool",1],["ACE_elasticBandage",5],["ACE_packingBandage",5],["rhs_mag_30Rnd_556x45_M855A1_Stanag_Tracer_Red",7,30],["B_IR_Grenade",1,1],["ACE_HandFlare_Green",1,1],["ACE_HandFlare_Red",1,1],["Chemlight_green",2,1],["ACE_Chemlight_IR",2,1],["AMP_Breaching_Charge_Mag",2,1],["ClaymoreDirectionalMine_Remote_Mag",1,1],["rhsusf_mag_15Rnd_9x19_FMJ",1,15]]],"rhsusf_ach_helmet_ocp","",["Rangefinder","","","",[],[],""],["ItemMap","","","ItemCompass","ItemWatch",""]];

_medic = [["rhs_weap_m4","","rhsusf_acc_anpeq15_wmx","rhsusf_acc_ACOG_RMR",["rhs_mag_30Rnd_556x45_M855A1_Stanag",30],[],"rhsusf_acc_grip1"],[],["rhsusf_weap_m9","","","",["rhsusf_mag_15Rnd_9x19_JHP",15],[],""],["rhs_uniform_cu_ocp_1stcav",[["ACE_EarPlugs",1],["ACE_IR_Strobe_Item",1],["ACE_microDAGR",1],["KNB_Notebook",1],["ACE_RangeCard",1],["ACE_MapTools",1],["ACE_tourniquet",4],["ACE_splint",4],["ACE_morphine",2],["ACE_Flashlight_MX991",1],["ACE_fieldDressing",5],["ACE_packingBandage",2],["ACRE_PRC343",1]]],["rhsusf_spcs_ocp_medic",[["ACE_adenosine",10],["ACE_epinephrine",10],["ACE_morphine",10],["rhs_mag_30Rnd_556x45_M855A1_Stanag",7,30],["rhsusf_mag_15Rnd_9x19_FMJ",3,15],["rhs_mag_an_m8hc",2,1],["SmokeShellBlue",2,1]]],["B_Carryall_cbr",[["ACE_fieldDressing",15],["ACE_elasticBandage",15],["ACE_packingBandage",15],["ACE_quikclot",15],["ACE_adenosine",10],["ACE_epinephrine",10],["ACE_morphine",10],["KNB_PanelRed",1],["ACE_salineIV",10],["ACE_salineIV_250",5],["ACE_salineIV_500",5],["ACE_splint",15],["ACE_surgicalKit",1],["ACE_tourniquet",10],["ACE_EntrenchingTool",1],["ACE_bodyBag",2]]],"rhsusf_ach_helmet_ocp","",["Rangefinder","","","",[],[],""],["ItemMap","","","ItemCompass","ItemWatch",""]];

_autorifleman = [["rhs_weap_m249_pip_S_para","","","rhsusf_acc_ELCAN",[],[],"rhsusf_acc_saw_lw_bipod"],[],[],["rhs_uniform_cu_ocp_1stcav",[["ACE_EarPlugs",1],["ACE_IR_Strobe_Item",1],["ACE_microDAGR",1],["KNB_Notebook",1],["ACE_RangeCard",1],["ACE_MapTools",1],["ACE_tourniquet",4],["ACE_splint",4],["ACE_morphine",2],["ACE_Flashlight_MX991",1],["ACE_fieldDressing",5],["ACE_packingBandage",2],["ACRE_PRC343_ID_2",1]]],["rhsusf_spcs_ocp_saw",[["ACE_elasticBandage",5],["ACE_packingBandage",5],["ACE_quikclot",2],["rhsusf_200Rnd_556x45_M855_mixed_soft_pouch",2,200],["rhs_mag_m67",2,1],["rhs_mag_an_m8hc",2,1]]],["B_Carryall_khk",[["ACE_elasticBandage",10],["ACE_fieldDressing",10],["ACE_quikclot",5],["ACE_packingBandage",10],["ACE_EntrenchingTool",1],["ACE_Tripod",1],["rhsusf_200Rnd_556x45_M855_mixed_soft_pouch",4,200]]],"rhsusf_ach_helmet_ocp","",["Rangefinder","","","",[],[],""],["ItemMap","","ItemRadioAcreFlagged","ItemCompass","ItemWatch",""]];

_crewman = [["rhs_weap_m4","","rhsusf_acc_anpeq15_wmx","rhsusf_acc_ACOG_RMR",[],[],"rhsusf_acc_grip1"],["rhs_weap_m72a7","","","",[],[],""],[],["rhs_uniform_cu_ocp_1stcav",[["ACE_EarPlugs",1],["ACE_IR_Strobe_Item",1],["ACE_microDAGR",1],["KNB_Notebook",1],["ACE_RangeCard",1],["ACE_MapTools",1],["ACE_tourniquet",4],["ACE_splint",4],["ACE_morphine",2],["ACE_Flashlight_MX991",1],["ACE_fieldDressing",5],["ACE_packingBandage",2],["ACRE_PRC343",1]]],["rhsusf_iotv_ocp_Rifleman",[["ACE_EntrenchingTool",1],["ACE_wirecutter",1],["KNB_PanelYellow",1],["ACE_fieldDressing",5],["ACE_elasticBandage",5],["ACE_packingBandage",5],["ACE_quikclot",5],["ACE_Flashlight_XL50",1],["rhs_mag_30Rnd_556x45_M855A1_Stanag",7,30]]],["rhsusf_assault_eagleaiii_ocp",[["ToolKit",1],["rhs_mag_30Rnd_556x45_M855A1_Stanag_Tracer_Red",5,30],["B_IR_Grenade",2,1]]],"rhsusf_cvc_green_helmet","",["Rangefinder","","","",[],[],""],["ItemMap","","","ItemCompass","ItemWatch",""]];

_uhPilot = [["rhs_weap_m4","","rhsusf_acc_anpeq15","rhsusf_acc_compm4",[],[],"rhsusf_acc_grip1"],[],["rhsusf_weap_m9","","","",["rhsusf_mag_15Rnd_9x19_JHP",15],[],""],["rhs_uniform_cu_ocp_1stcav",[["ACE_Flashlight_XL50",1],["ACE_microDAGR",1],["KNB_Notebook",1],["ACE_fieldDressing",5],["ACE_elasticBandage",5],["ACE_packingBandage",5],["ACE_bodyBag",1],["ACE_quikclot",5],["ACE_EarPlugs",1],["KNB_PanelYellow",1],["ACE_tourniquet",4],["ACE_IR_Strobe_Item",1]]],["rhsusf_spcs_ocp_crewman",[["rhsusf_mag_15Rnd_9x19_FMJ",3,15],["rhs_mag_30Rnd_556x45_M855A1_Stanag",7,30],["ACE_M14",1,1],["rhs_mag_an_m8hc",2,1],["ACE_Chemlight_IR",2,1],["B_IR_Grenade",2,1],["Chemlight_green",2,1],["ACE_HandFlare_Green",1,1],["SmokeShellBlue",1,1]]],["rhsusf_assault_eagleaiii_ocp",[["ACRE_PRC117F",1],["ACE_EntrenchingTool",1],["ACE_IR_Strobe_Item",1],["SmokeShellBlue",1,1],["ACE_HandFlare_Green",1,1],["ACE_Chemlight_IR",1,1],["Chemlight_green",1,1]]],"rhsusf_hgu56p_tan","",["Rangefinder","","","",[],[],""],["ItemMap","","ItemRadioAcreFlagged","ItemCompass","ItemWatch",""]];

_ahPilot = [["rhs_weap_m4","","rhsusf_acc_anpeq15","rhsusf_acc_compm4",[],[],"rhsusf_acc_grip1"],[],["rhsusf_weap_m9","","","",["rhsusf_mag_15Rnd_9x19_JHP",15],[],""],["rhs_uniform_cu_ocp_1stcav",[["ACE_Flashlight_XL50",1],["ACE_microDAGR",1],["KNB_Notebook",1],["ACE_fieldDressing",5],["ACE_elasticBandage",5],["ACE_packingBandage",5],["ACE_bodyBag",1],["ACE_quikclot",5],["ACE_EarPlugs",1],["KNB_PanelYellow",1],["ACE_tourniquet",4],["ACE_IR_Strobe_Item",1]]],["rhsusf_spcs_ocp_crewman",[["rhsusf_mag_15Rnd_9x19_FMJ",3,15],["rhs_mag_30Rnd_556x45_M855A1_Stanag",7,30],["ACE_M14",1,1],["rhs_mag_an_m8hc",2,1],["ACE_Chemlight_IR",2,1],["B_IR_Grenade",2,1],["Chemlight_green",2,1],["ACE_HandFlare_Green",1,1],["SmokeShellBlue",1,1]]],["rhsusf_assault_eagleaiii_ocp",[["ACRE_PRC117F",1],["ACE_EntrenchingTool",1],["ACE_IR_Strobe_Item",1],["SmokeShellBlue",1,1],["ACE_HandFlare_Green",1,1],["ACE_Chemlight_IR",1,1],["Chemlight_green",1,1]]],"rhsusf_ihadss","",["Rangefinder","","","",[],[],""],["ItemMap","","ItemRadioAcreFlagged","ItemCompass","ItemWatch",""]];

// Make a mapping from loadout name to loadout variable
// The third index is a whitelist. If it's empty, then everyone is allowed. Otherwise,
// only units whose roles are in the whitelist are allowed to equip those loadouts.
_loadoutMapping = [
  ["Rifleman", _rifleman, []],
  ["Rifleman CLS", _riflemanCLS, []],
  ["Grenadier", _grenadier, []],
  ["Team/Squad Leader", _team_squad_leader, []],
  ["Medic", _medic, ["Regiment Commander@Regiment Headquarters", "Regiment XO@Regiment Headquarters", "Regiment CSM@Regiment Headquarters", "Section Leader@Medic Section", "Assistant Section Leader@Medic Section", "Team Leader@Medic Section", "Medic@Medic Section"]],
  ["Autorifleman", _autorifleman, []],
  ["Crewman", _crewman, ["Section Leader@BFV Section","Regiment Commander@Regiment Headquarters", "Regiment XO@Regiment Headquarters", "Regiment CSM@Regiment Headquarters", "Assistant Section Leader@BFV Section", "Vehicle Commander@BFV Section", "Gunner@BFV Section", "Alternate@BFV Section", "Driver@BFV Section"]],
  ["UH60 Pilot", _uhPilot, ["Detachment Commander@CAB", "Assistant Detachment Commander@CAB", "UH-60 Pilot@CAB", "AH-64 Pilot@CAB", "Regiment Commander@Regiment Headquarters", "Regiment XO@Regiment Headquarters", "Regiment CSM@Regiment Headquarters"]],
  ["AH64 Pilot", _ahPilot, ["Detachment Commander@CAB", "Assistant Detachment Commander@CAB", "UH-60 Pilot@CAB", "AH-64 Pilot@CAB", "Regiment Commander@Regiment Headquarters", "Regiment XO@Regiment Headquarters", "Regiment CSM@Regiment Headquarters"]]
];

// Local variables
_caller = (_this select 1);

_loadout = (_this select 3) select 0;

// Give the user a message saying what loadout they selected.
// Notice that we go through BIS_fnc_MP so that it doesn't give
// everyone on the server the message.
[format ["Selected %1 Loadout", _loadout], "hint", _caller, true] call BIS_fnc_MP;

// Search the mapping for an entry where the first name matches the given name.
{
  if ((_x select 0) == _loadout) then {
    _whitelist = _x select 2;
    _unitRole = roleDescription _caller;
    _inWhitelist = _whitelist findIf {_x == _unitRole} > -1;
    if (_whitelist isEqualTo [] || _inWhitelist) then {
      _caller setUnitLoadout (_x select 1);
    } else {
      [format ["You do not have permission to equip %1 loadout. Your role is %2", _loadout, _unitRole], "hint", _caller, true] call BIS_fnc_MP;
    };  
  }
} forEach _loadoutMapping;
